# flask-apcore Demo

Task Manager API demonstrating Flask routes → Scanner → Registry → MCP Server pipeline with observability.

## What's Inside

| File | Purpose |
|---|---|
| `app.py` | Task Manager API with Pydantic models and `@module` example |
| `apcore_modules/` | Scanned YAML binding files (generated by `flask apcore scan`) |
| `Dockerfile` | Installs flask-apcore[mcp] from local source |
| `docker-compose.yml` | One-click Docker launch |
| `entrypoint.sh` | Scans routes then starts the MCP server |

## Local Development

### Prerequisites

From the project root, install flask-apcore in editable mode with all extras:

```bash
pip install -e ".[mcp,dev]"
```

### 1. Scan routes

```bash
cd examples/demo
export FLASK_APP=app.py

# Generate YAML bindings
flask apcore scan --output yaml --dir ./apcore_modules
```

### 2. Start the MCP server

```bash
flask apcore serve --http --host 127.0.0.1 --port 9100 --validate-inputs --log-level DEBUG
```

### 3. Verify

```bash
# Health check
curl http://127.0.0.1:9100/health
```

Connect from any MCP client (e.g., Claude Desktop) using `http://127.0.0.1:9100`.

### 4. Explorer (optional)

Enable the built-in schema explorer by adding config to `app.py`:

```python
app.config.update(
    APCORE_EXPLORER_ENABLED=True,
    APCORE_EXPLORER_URL_PREFIX="/apcore",       # default
    APCORE_EXPLORER_ALLOW_EXECUTE=True,         # enable Try-it execution
)
```

Then start the Flask dev server:

```bash
flask run --port 5000
```

Browse to:

- `http://127.0.0.1:5000/apcore/` — Interactive HTML explorer with Try-it
- `http://127.0.0.1:5000/apcore/modules` — Module list (JSON)
- `http://127.0.0.1:5000/apcore/modules/<module_id>` — Module detail (JSON)

## Docker

```bash
cd examples/demo
docker compose up --build
```

This will build a container, scan routes, and start the MCP server on `http://localhost:9100`.

```bash
# Cleanup
docker compose down
```

## Features Demonstrated

- **Route scanning** — `flask apcore scan` discovers all 5 CRUD routes
- **Annotation inference** — GET→readonly, DELETE→destructive, PUT→idempotent
- **Pydantic schemas** — Input validation from `TaskCreate` and `TaskUpdate` models
- **@module decorator** — `task_stats.v1` registered alongside scanned routes
- **Schema explorer** — Browser-based module viewer with Try-it execution
- **MCP server** — HTTP transport on port 9100
- **Observability** — Tracing (stdout), metrics, and structured JSON logging
- **Input validation** — `--validate-inputs` checks tool inputs against schemas
