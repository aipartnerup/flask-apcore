# flask-apcore Demo

Task Manager API demonstrating Flask routes → Scanner → Registry → MCP Server pipeline with observability.

## What's Inside

| File | Purpose |
|---|---|
| `app.py` | Task Manager API with Pydantic models and `@module` example |
| `apcore_modules/` | Scanned YAML binding files (generated by `flask apcore scan`) |
| `Dockerfile` | Installs flask-apcore[mcp] from local source |
| `docker-compose.yml` | One-click Docker launch |
| `entrypoint.sh` | Scans routes then starts the MCP server |

## Local Development

### Prerequisites

From the project root, install flask-apcore in editable mode with all extras:

```bash
pip install -e ".[mcp,dev]"
```

### 1. Scan routes

```bash
cd examples/demo
export FLASK_APP=app.py

# Generate YAML bindings
flask apcore scan --output yaml --dir ./apcore_modules
```

### 2. Start the MCP server

```bash
flask apcore serve --http --host 127.0.0.1 --port 9100 --validate-inputs --log-level DEBUG
```

### 3. Verify

```bash
# Health check
curl http://127.0.0.1:9100/health
```

Connect from any MCP client (e.g., Claude Desktop) using `http://127.0.0.1:9100`.

### 4. Explorer (optional)

Start the MCP server with the built-in Tool Explorer UI:

> **Security:** The Explorer exposes module schemas and execution via unauthenticated HTTP.
> Only enable in **development/staging**. Do NOT enable in production without adding your own auth layer.

```bash
flask apcore serve --http --host 127.0.0.1 --port 9100 --explorer --allow-execute
```

Browse to `http://127.0.0.1:9100/explorer/` for the interactive module explorer with Try-it execution.

#### Example payloads for Try-it

The demo ships with 2 seed tasks (id 1 and 2). Use these example inputs in the explorer:

| Module | Example input |
|---|---|
| `task_stats.v1` | *(no input required)* |
| `list_tasks.get` | *(no input required)* |
| `get_task.get` | `{"task_id": 1}` |
| `create_task.post` | `{"title": "Buy milk", "description": "From the store", "done": false}` |
| `update_task.put` | `{"task_id": 1, "title": "Try flask-apcore (done!)", "done": true}` |
| `delete_task.delete` | `{"task_id": 2}` |

## Docker

```bash
cd examples/demo
docker compose up --build
```

This will build a container, scan routes, and start the MCP server on `http://localhost:9100`.

```bash
# Cleanup
docker compose down
```

## Features Demonstrated

- **Route scanning** — `flask apcore scan` discovers all 5 CRUD routes
- **Annotation inference** — GET→readonly, DELETE→destructive, PUT→idempotent
- **Pydantic schemas** — Input validation from `TaskCreate` and `TaskUpdate` models
- **@module decorator** — `task_stats.v1` registered alongside scanned routes
- **MCP Tool Explorer** — Browser-based module viewer via `flask apcore serve --explorer`
- **MCP server** — HTTP transport on port 9100
- **Observability** — Tracing (stdout), metrics, and structured JSON logging
- **Input validation** — `--validate-inputs` checks tool inputs against schemas
